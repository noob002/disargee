<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE MINORITY: SYSTEM BREACH</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');

        :root {
            --main-color: #33ff33; /* 기본 초록색 */
            --danger-color: #ff3333; /* 위험 빨간색 */
            --bg-color: #050505;
        }

        body {
            background-color: #000;
            color: var(--main-color);
            font-family: 'VT323', monospace;
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            text-transform: uppercase;
            user-select: none;
        }

        /* 상태에 따른 색상 변경 클래스 */
        body.red-mode {
            --main-color: var(--danger-color);
            animation: shake 0.5s; /* 전환 시 화면 흔들림 */
        }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        .crt-frame {
            border: 4px solid var(--main-color);
            padding: 40px;
            width: 700px;
            max-width: 90%;
            height: 500px; /* 고정 높이 */
            box-shadow: 0 0 20px var(--main-color), inset 0 0 30px rgba(0,0,0,0.8);
            background-color: var(--bg-color);
            position: relative;
            display: flex;
            flex-direction: column;
            transition: border-color 1s, box-shadow 1s;
        }

        /* 스캔라인 (CRT 효과) */
        .scanline {
            width: 100%;
            height: 100px;
            background: linear-gradient(0deg, rgba(0,0,0,0) 0%, rgba(255, 255, 255, 0.04) 50%, rgba(0,0,0,0) 100%);
            opacity: 0.1;
            position: absolute;
            bottom: 100%;
            animation: scanline 6s linear infinite;
            pointer-events: none;
            z-index: 999;
        }

        @keyframes scanline {
            0% { bottom: 100%; }
            100% { bottom: -100%; }
        }

        /* 공통 UI 요소 */
        .header {
            display: flex;
            justify-content: space-between;
            border-bottom: 2px solid var(--main-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        button {
            background: transparent;
            border: 2px solid var(--main-color);
            color: var(--main-color);
            font-family: 'VT323', monospace;
            font-size: 1.8rem;
            padding: 10px 20px;
            cursor: pointer;
            transition: 0.2s;
            margin: 10px;
        }

        button:hover {
            background-color: var(--main-color);
            color: #000;
        }

        /* --- SCREEN: START --- */
        #screen-start { text-align: center; }
        .blink { animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        /* --- SCREEN: PHASE 1 (소수결) --- */
        #screen-phase1 { display: none; width: 100%; text-align: center; }
        .question-text {
            font-size: 2rem;
            min-height: 80px;
            margin-bottom: 30px;
        }
        .btn-group { display: flex; width: 100%; gap: 20px; }
        .btn-group button { flex: 1; }
        
        .result-bar-bg {
            width: 100%;
            height: 20px;
            background: #111;
            border: 1px solid var(--main-color);
            margin-top: 20px;
            display: none;
        }
        .result-bar-fill {
            height: 100%;
            background: var(--main-color);
            width: 0%;
            transition: width 0.8s ease-out;
        }

        /* --- SCREEN: PHASE 2 (해킹) --- */
        #screen-phase2 { display: none; width: 100%; text-align: center; }
        .code-box {
            font-size: 4rem;
            letter-spacing: 15px;
            margin: 20px 0;
            border: 2px dashed var(--main-color);
            padding: 20px;
            background: rgba(255, 51, 51, 0.1);
        }
        .hack-input {
            background: transparent;
            border: none;
            border-bottom: 3px solid var(--main-color);
            color: var(--main-color);
            font-family: 'VT323', monospace;
            font-size: 2.5rem;
            text-align: center;
            width: 80%;
            outline: none;
            text-transform: uppercase;
        }
        .timer-bg {
            width: 100%;
            height: 10px;
            background: #330000;
            margin-top: 30px;
        }
        .timer-fill {
            width: 100%;
            height: 100%;
            background: #ff3333;
        }

        /* --- SCREEN: END --- */
        #screen-end { display: none; text-align: center; }
        .big-msg { font-size: 4rem; margin: 0; }
        .sub-msg { font-size: 1.5rem; margin-top: 10px; color: #888; }

    </style>
</head>
<body>
    <div class="scanline"></div>

    <div class="crt-frame">
        <div class="header">
            <span>STAGE: <span id="stage-display">WAITING</span></span>
            <span>STATUS: <span id="status-display">CONNECTED</span></span>
        </div>

        <div class="content-area">
            
            <div id="screen-start">
                <h1 style="font-size: 3rem; margin-bottom: 5px;">THE MINORITY</h1>
                <p style="margin-bottom: 40px;">당신은 소수에 속해야 살아남습니다.</p>
                <button onclick="startGame()" class="blink">>> SYSTEM BOOT <<</button>
            </div>

            <div id="screen-phase1">
                <div class="question-text" id="p1-text"></div>
                
                <div class="btn-group" id="p1-btns">
                    <button onclick="checkAnswer(true)">[Y] AGREE</button>
                    <button onclick="checkAnswer(false)">[N] DISAGREE</button>
                </div>

                <div id="p1-result">
                    <div class="result-bar-bg" id="bar-bg">
                        <div class="result-bar-fill" id="bar-fill"></div>
                    </div>
                    <p id="p1-msg" style="height: 30px; margin-top: 15px;"></p>
                    <button id="next-btn" onclick="nextPhase1()" style="display:none; width:100%; margin: 20px 0;">NEXT SEQUENCE >></button>
                </div>
            </div>

            <div id="screen-phase2">
                <h2 class="blink" style="color: #ff3333;">⚠ WARNING: INTRUSION DETECTED ⚠</h2>
                <div class="code-box" id="p2-code">????</div>
                <input type="text" class="hack-input" id="p2-input" placeholder="TYPE CODE" onkeyup="checkHackInput(event)" autocomplete="off">
                <div class="timer-bg"><div class="timer-fill" id="p2-timer"></div></div>
                <p id="p2-info">DEFENSE REQUIRED: 0 / 3</p>
            </div>

            <div id="screen-end">
                <h1 class="big-msg" id="end-title">GAME OVER</h1>
                <p class="sub-msg" id="end-desc">REASON: MAJORITY DETECTED</p>
                <button onclick="location.reload()" style="margin-top: 40px;">SYSTEM REBOOT</button>
            </div>

        </div>
    </div>

    <script>
        /* ================= 초기 설정 ================= */
        // 질문 데이터 (rate: 동의율)
        // rate가 50 이상인 질문에서 '동의'하면 패배, '거절'하면 승리
        const questions = [
            { q: "비 오는 날보다 맑은 날이 좋다.", rate: 80 },  // 거절(20%)해야 생존
            { q: "나는 민트초코를 돈 주고 사 먹는다.", rate: 30 }, // 동의(30%)해야 생존
            { q: "솔직히 100억 주면 감옥 1년 간다.", rate: 75 },  // 거절(25%)해야 생존
            { q: "다시 태어나도 한국인으로 태어난다.", rate: 45 }, // 동의(45%)해야 생존
        ];

        let currentQ = 0;
        let isDead = false;

        // 해킹 게임 변수
        let hackScore = 0;
        const hackGoal = 3;
        let hackTimer;
        let timeLeft = 100;
        const hackSpeed = 0.8; // 타이머 줄어드는 속도 (높을수록 빠름)

        /* ================= 함수 로직 ================= */

        // 1. 게임 시작
        function startGame() {
            switchScreen('screen-phase1');
            document.getElementById('stage-display').innerText = "1 - MINORITY";
            showQuestion();
        }

        // 화면 전환 유틸리티
        function switchScreen(id) {
            const screens = ['screen-start', 'screen-phase1', 'screen-phase2', 'screen-end'];
            screens.forEach(s => document.getElementById(s).style.display = 'none');
            document.getElementById(id).style.display = 'block';
        }

        // --- PHASE 1: 소수결 ---
        function showQuestion() {
            const q = questions[currentQ];
            document.getElementById('p1-text').innerText = `"${q.q}"`;
            
            // UI 초기화
            document.getElementById('p1-btns').style.display = 'flex';
            document.getElementById('bar-bg').style.display = 'none';
            document.getElementById('next-btn').style.display = 'none';
            document.getElementById('p1-msg').innerText = "";
            document.getElementById('bar-fill').style.width = "0%";
        }

        function checkAnswer(agree) {
            const q = questions[currentQ];
            const myRate = agree ? q.rate : (100 - q.rate);
            const survived = myRate < 50;

            // 결과 연출
            document.getElementById('p1-btns').style.display = 'none';
            document.getElementById('bar-bg').style.display = 'block';
            
            setTimeout(() => {
                document.getElementById('bar-fill').style.width = myRate + "%";
            }, 50);

            if (survived) {
                document.getElementById('p1-msg').innerText = `생존. 당신은 ${myRate}%의 소수입니다.`;
                document.getElementById('p1-msg').style.color = "var(--main-color)";
                document.getElementById('next-btn').style.display = 'inline-block';
            } else {
                document.getElementById('p1-msg').innerText = `발각. 당신은 ${myRate}%의 다수입니다.`;
                document.getElementById('p1-msg').style.color = "red"; // 실패는 빨간색
                isDead = true;
                document.getElementById('next-btn').style.display = 'inline-block';
                document.getElementById('next-btn').innerText = "CONNECTION LOST...";
            }
        }

        function nextPhase1() {
            if (isDead) {
                showEnd("GAME OVER", "당신은 평범한 다수였습니다.");
                return;
            }

            currentQ++;
            if (currentQ >= questions.length) {
                // 1부 클리어 -> 2부 시작
                startPhase2();
            } else {
                showQuestion();
            }
        }

        // --- PHASE 2: 해킹 디펜스 ---
        function startPhase2() {
            // 분위기 전환 (Red Mode)
            document.body.classList.add('red-mode');
            document.getElementById('stage-display').innerText = "2 - BREACH";
            document.getElementById('status-display').innerText = "DANGER";
            
            switchScreen('screen-phase2');
            
            // 해킹 게임 시작
            nextHack();
        }

        function generateCode() {
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
            let res = "";
            for(let i=0; i<4; i++) res += chars.charAt(Math.floor(Math.random() * chars.length));
            return res;
        }

        function nextHack() {
            if (hackScore >= hackGoal) {
                showEnd("ALL CLEAR", "당신은 완벽한 아웃사이더입니다.");
                document.getElementById('end-title').style.color = "#33ff33";
                document.body.classList.remove('red-mode');
                return;
            }

            const code = generateCode();
            document.getElementById('p2-code').innerText = code;
            document.getElementById('p2-input').value = "";
            document.getElementById('p2-input').focus();
            
            // 타이머 리셋
            timeLeft = 100;
            clearInterval(hackTimer);
            
            hackTimer = setInterval(() => {
                timeLeft -= hackSpeed;
                document.getElementById('p2-timer').style.width = timeLeft + "%";
                
                if (timeLeft <= 0) {
                    clearInterval(hackTimer);
                    showEnd("HACKED", "시스템 방어에 실패했습니다.");
                }
            }, 20); // 20ms마다 갱신
        }

        function checkHackInput(e) {
            if (e.key === "Enter") {
                const target = document.getElementById('p2-code').innerText;
                const userIn = document.getElementById('p2-input').value.toUpperCase();

                if (target === userIn) {
                    // 성공
                    hackScore++;
                    document.getElementById('p2-info').innerText = `DEFENSE REQUIRED: ${hackScore} / ${hackGoal}`;
                    nextHack();
                } else {
                    // 실패시 입력창 흔들림 효과 (CSS shake 재활용 가능하지만 간단히 빨갛게)
                    document.getElementById('p2-input').value = "";
                    document.getElementById('screen-phase2').classList.add('blink');
                    setTimeout(() => document.getElementById('screen-phase2').classList.remove('blink'), 500);
                }
            }
        }

        // --- END SCREEN ---
        function showEnd(title, desc) {
            clearInterval(hackTimer); // 타이머 확실히 중지
            switchScreen('screen-end');
            document.getElementById('end-title').innerText = title;
            document.getElementById('end-desc').innerText = desc;
        }

    </script>
</body>
</html>
